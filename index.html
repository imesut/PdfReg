<!DOCTYPE html>
<html>

<head>
    <title>RegSelect</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width" initial-scale=1">
    <link href="vendor/css/bootstrap.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="vendor/js/bootstrap.min.js"></script>
    <script src="vendor/js/pdf.js"></script>
    <link type="text/css" href="vendor/css/text_layer_builder.css" rel="stylesheet">
    <script type="text/javascript" src="vendor/js/text_layer_builder.js"></script>
    <script type="text/javascript" src="js/getRegText.js"></script>
    
    <style>
        #pdfcontainer{
        border: 1px solid;
    }
    </style>
</head>

<body>
    <div class="container" style="margin:20px">
        <div class="col-md-8">
            <h2>PDF</h2>
            <div id="pdfcontainer"></div>

        </div>
        <div class="col-md-4">
            <h2>Settings</h2>
            Zoom: <button class="btn btn-default" id="plus">+</button><button class="btn btn-default" id="minus">-</button>
            <br>
            Page: <input type="text" id="pageInput" class="form-control" value="1">
            <br>
            Xi: <input type="text" id="Xi" class="form-control" value="1">
            <br>
            Yi: <input type="text" id="Yi" class="form-control" value="1">
            <br>
            Xl: <input type="text" id="Xl" class="form-control" value="1">
            <br>
            Yl: <input type="text" id="Yl" class="form-control" value="1">
            <br>
            <a onclick="getText()" class="btn btn-default" id="getTextBtn">Get Text in Rect</a>
        </div>
    </div>

    <script>
        function getText() {
            var result = getTextInRect(
                parseFloat(document.getElementById("pageInput").value),
                parseFloat(document.getElementById("Xi").value),
                parseFloat(document.getElementById("Yi").value),
                parseFloat(document.getElementById("Xl").value),
                parseFloat(document.getElementById("Yl").value)
            );

            console.log(result);
        }
    </script>

    <script>
        PDFJS = pdfjsLib;

        pdfjsLib.getDocument('sample.pdf').then(
            function (pdf) {
                var container = document.getElementById("pdfcontainer");

                for (var i = 1; i <= pdf.numPages; i++) {

                    pdf.getPage(i).then(
                        function (page) {
                            var scale = 1;
                            var viewport = page.getViewport(scale);
                            var div = document.createElement("div");

                            div.setAttribute("id", "page-" + (page.pageIndex + 1));
                            div.setAttribute("style", "position: relative");
                            container.appendChild(div);

                            var canvas = document.createElement("canvas");
                            div.appendChild(canvas);

                            var context = canvas.getContext('2d');

                            canvas.height = viewport.height;
                            canvas.width = viewport.width;

                            var renderContext = {
                                canvasContext: context,
                                viewport: viewport
                            };

                            page.render(renderContext).then(function () {
                                return page.getTextContent();
                            }).then(
                                function (textContent) {
                                    var textLayerDiv = document.createElement("div");
                                    textLayerDiv.setAttribute("class", "textLayer");
                                    div.appendChild(textLayerDiv);

                                    var textLayer = new TextLayerBuilder({
                                        textLayerDiv: textLayerDiv,
                                        pageIndex: page.pageIndex,
                                        viewport: viewport
                                    });

                                    textLayer.setTextContent(textContent);
                                    textLayer.render();
                                });

                        });

                };
            });
    </script>

    <script type="text/javascript">
        pdfjsLib.workerSrc = "vendor/js/pdf.worker.js";
    </script>

</body>

</html>